<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  

<mapper namespace="lars.model.mybatis.mapper.User">

  <resultMap id="Result" type="lards.model.dto.User">
    <constructor>
      <idArg column="id" javaType="java.lang.Long"/>
      <arg column="firstname" javaType="String"/>
      <arg column="lastname" javaType="String"/>
    </constructor>
    <association property="role" column="role_id" javaType="lards.model.dto.Role" select="role.get_by_id"/>
    <collection property="location" column="id" javaType="java.util.HashSet" ofType="lards.model.dto.Location" select="location.get_by_id"/>
  </resultMap>

  <select id="get_by_id" parameterType="Long" resultMap="lars.model.mybatis.mapper.User.Result">
    SELECT * FROM "user" WHERE ID = #{value}
  </select>

  <select id="get_all" resultMap="lars.model.mybatis.mapper.User.Result">
    SELECT * FROM "user"
  </select>

	<update id="update" parameterType="lards.model.dto.User"> 
    UPDATE "user" SET
    firstname = #{firstname},
    lastname = #{lastname},
    role_id = #{role.id}
    WHERE id = #{id}
	</update>	

  <insert id="insert" parameterType="lards.model.dto.User">
	    INSERT INTO "user" (firstname, lastname, role_id) 
	    values (#{firstname}, #{lastname}, #{role.id})
  </insert>

	<delete id="delete" parameterType="collection"> 
    DELETE FROM "user" WHERE 
      <foreach collection="_parameter" item="parm" 
               separator="OR">
        id = #{parm.id}
      </foreach>
	</delete>

  <select id="role.get_by_id" parameterType="Long" resultType="lards.model.dto.Role">
    SELECT * FROM "role" WHERE ID = #{value}
  </select>

  <select id="location.get_by_id" parameterType="Long" resultType="lards.model.dto.Location">
    SELECT L.id,description FROM LOCATION L JOIN USER_LOCATION UL ON L.id = UL.id_location WHERE id_user = #{id}
  </select>

	<insert id="location.insert" parameterType="collection"> 
	</insert>

	<delete id="location.delete" parameterType="collection"> 
	</delete>



</mapper>
